name: Generate PDF

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'          # ← 依存キャッシュ

      - name: Install dependencies
        run: npm ci             # npm install より再現性が高い

      - name: Build PDF
        run: node build.js

      - name: Upload PDF
        uses: actions/upload-artifact@v4
        with:
          name: booklet
          path: booklet.pdf
          retention-days: 14    # ← 任意。無指定なら 90 日

      - name: Notify WordPress with Run ID
        env:
          WEBHOOK: ${{ secrets.WP_WEBHOOK_URL }}
        run: |
          curl -X POST "$WEBHOOK" \
          -H "Content-Type: application/json" \
          -d "{\"run_id\": \"${{ github.run_id }}\"}"
